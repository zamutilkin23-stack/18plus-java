{% extends "base.html" %}
{% block content %}
<h1>üë• –£—á–∞—Å—Ç–Ω–∏–∫–∏ (2‚Äì6)</h1>
<form id="players-form">
    <div class="player-form" data-id="1">
        <h3>–ò–≥—Ä–æ–∫ 1</h3>
        <label>–ü–æ–ª: 
            <select name="gender">
                <option value="–ú">–ú</option>
                <option value="–ñ">–ñ</option>
            </select>
        </label>
        <label>–ò–º—è: <input name="name" required></label>
        <label>–û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è:
            <input name="orientation" list="orientations" placeholder="–í—ã–±–µ—Ä–∏—Ç–µ –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ..." value="–ú–ñ">
        </label>
    </div>
</form>

<datalist id="orientations">
    <option value="–ú">
    <option value="–ñ">
    <option value="–ú–ñ">
    <option value="–ú–ú">
    <option value="–ñ–ñ">
    <option value="–ú–ñ–ú">
    <option value="–ñ–ú–ñ">
    <option value="–ú–ñ–ú–ñ">
    <option value="–ú–ú–ñ">
    <option value="–ú–ñ–ñ">
    <option value="–ú–ú–ú">
    <option value="–ñ–ñ–ñ">
    <option value="–ú–ú–ú–ñ">
    <option value="–ú–ú–ú–ñ–ñ–ñ">
    <option value="–ú–ñ–ñ–ñ">
    <option value="–ú–ú–ñ–ñ">
    <option value="–ú–ú–ñ–ñ–ú–ñ">
</datalist>

<button onclick="addPlayer()" class="btn-small">+ –î–æ–±–∞–≤–∏—Ç—å</button>
<br><br>
<button onclick="startGame()" class="btn">üöÄ –°—Ç–∞—Ä—Ç</button>

<script>
let playerCount = 1;
function addPlayer() {
    if (playerCount >= 5) return;
    playerCount++;
    const div = document.createElement('div');
    div.className = 'player-form';
    div.innerHTML = `
        <h3>–ò–≥—Ä–æ–∫ \${playerCount}</h3>
        <label>–ü–æ–ª: 
            <select name="gender">
                <option value="–ú">–ú</option>
                <option value="–ñ">–ñ</option>
            </select>
        </label>
        <label>–ò–º—è: <input name="name" required></label>
        <label>–û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è:
            <input name="orientation" list="orientations" placeholder="–í—ã–±–µ—Ä–∏—Ç–µ –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ..." value="–ú–ñ">
        </label>
        <button type="button" onclick="removePlayer(this)">–£–¥–∞–ª–∏—Ç—å</button>
    `;
    document.getElementById('players-form').appendChild(div);
}
function removePlayer(btn) {
    if (playerCount <= 2) return;
    btn.parentElement.remove();
    playerCount--;
}
function startGame() {
    const players = [];
    document.querySelectorAll('.player-form').forEach(f => {
        const name = f.querySelector('[name=name]').value;
        const gender = f.querySelector('[name=gender]').value;
        const orientation = f.querySelector('[name=orientation]').value;
        if (name) players.push({name, gender, orientation});
    });
    if (players.length < 2) {
        alert('–ù—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º 2 –∏–≥—Ä–æ–∫–∞!');
        return;
    }
    fetch('/api/start-game', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(players)
    }).then(() => window.location.href = '/board');
}
</script>
{% endblock %}